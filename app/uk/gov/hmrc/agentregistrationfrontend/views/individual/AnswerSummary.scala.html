@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentregistration.shared.individual.IndividualProvidedDetails
@import uk.gov.hmrc.agentregistration.shared.individual.IndividualDateOfBirth
@import uk.gov.hmrc.agentregistration.shared.individual.{IndividualNino, IndividualSaUtr}
@import uk.gov.hmrc.agentregistration.shared.LinkId
@import uk.gov.hmrc.agentregistration.shared.util.Errors.getOrThrowExpectedDataMissing
@import uk.gov.hmrc.agentregistrationfrontend.util.DisplayDate.displayDateForLang

@import java.time.LocalDate

@this(
        govukSummaryList: GovukSummaryList
)

@(
        key: String,
        individualProvidedDetails: IndividualProvidedDetails,
        linkId: LinkId)(implicit
        request: RequestHeader,
        messages: Messages
)

@makeSummaryListRow(labelKey: String, valueText: String, changeHref: String) = @{
    SummaryListRow(
        key = Key(content = Text(messages(labelKey))),
        value = Value(content = Text(valueText)),
        actions = Some(
            Actions(
                items = Seq(
                    ActionItem(
                        href = changeHref,
                        content = Text(messages("common.change")),
                        visuallyHiddenText = Some(messages(labelKey))
                    )
                )
            )
        )
    )
}

@telephoneRow = @{
    makeSummaryListRow(
        labelKey = s"$key.telephone.label",
        valueText = individualProvidedDetails.getTelephoneNumber.value,
        changeHref = AppRoutes.providedetails.IndividualTelephoneNumberController.show(linkId).toString
    )
}

@emailRow = @{
    makeSummaryListRow(
        labelKey = s"$key.email.label",
        valueText = individualProvidedDetails.getEmailAddress.emailAddress.value,
        changeHref = AppRoutes.providedetails.IndividualEmailAddressController.show(linkId).toString
    )
}

@dateOfBirthRow(dob: LocalDate) = @{
    makeSummaryListRow(
        labelKey = s"$key.dateOfBirth.label",
        valueText = displayDateForLang(Some(dob)),
        changeHref = AppRoutes.providedetails.IndividualDateOfBirthController.show(linkId).toString
    )
}

@hasNinoRow(hasNino: String) = @{
    makeSummaryListRow(
        labelKey = s"$key.hasNino.label",
        valueText = hasNino,
        changeHref = AppRoutes.providedetails.IndividualNinoController.show(linkId).toString
    )
}

@ninoRow(ninoText: String) = @{
    makeSummaryListRow(
        labelKey = s"$key.nino.label",
        valueText = ninoText,
        changeHref = AppRoutes.providedetails.IndividualNinoController.show(linkId).toString
    )
}

@hasSaUtrRow(hasSaUtr: String) = @{
    makeSummaryListRow(
        labelKey = s"$key.hasSaUtr.label",
        valueText = hasSaUtr,
        changeHref = AppRoutes.providedetails.IndividualSaUtrController.show(linkId).toString
    )
}

@saUtrRow(saUtrText: String) = @{
    makeSummaryListRow(
        labelKey = s"$key.saUtr.label",
        valueText = saUtrText,
        changeHref = AppRoutes.providedetails.IndividualSaUtrController.show(linkId).toString
    )
}

@rows = @{
    val base = Seq(telephoneRow, emailRow)

  val dateOfBirthRows = individualProvidedDetails.getDateOfBirth match {
        case IndividualDateOfBirth.Provided(dob) => Seq(dateOfBirthRow(dob))
        case _ => Seq.empty[SummaryListRow]
    }

    val ninoRows = individualProvidedDetails.getNino match {
        case IndividualNino.Provided(nino) => Seq(hasNinoRow("Yes"), ninoRow(nino.value))
        case IndividualNino.NotProvided => Seq(hasNinoRow("No"))
        case _: IndividualNino.FromAuth => Seq.empty[SummaryListRow]
    }

    val saUtrRows = individualProvidedDetails.getSaUtr match {
        case IndividualSaUtr.Provided(saUtr) => Seq(hasSaUtrRow("Yes"), saUtrRow(saUtr.value))
        case IndividualSaUtr.NotProvided => Seq(hasSaUtrRow("No"))
        case _: IndividualSaUtr.FromAuth => Seq.empty[SummaryListRow]
        case _: IndividualSaUtr.FromCitizenDetails => Seq.empty[SummaryListRow]
    }

    base ++ dateOfBirthRows ++ ninoRows ++ saUtrRows
}

@govukSummaryList(SummaryList(rows = rows))
