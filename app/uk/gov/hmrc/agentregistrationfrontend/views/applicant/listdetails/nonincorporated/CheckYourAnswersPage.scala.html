@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentregistration.shared.lists.FiveOrLess
@import uk.gov.hmrc.agentregistration.shared.lists.SixOrMore
@import uk.gov.hmrc.agentregistrationfrontend.views.html.applicant.partials.ContinueOrSaveForLaterLinks
@import uk.gov.hmrc.agentregistrationfrontend.views.html.Layout
@import uk.gov.hmrc.govukfrontend.views.html.components.*
@import uk.gov.hmrc.agentregistration.shared.individual.IndividualProvidedDetails
@import uk.gov.hmrc.agentregistrationfrontend.util.MessageKeys
@import uk.gov.hmrc.agentregistration.shared.lists.NumberOfRequiredKeyIndividuals

@this(
        layout: Layout,
        govukButton: GovukButton,
        govukSummaryList: GovukSummaryList,
        govukInsetText: GovukInsetText,
        govukWarningText: GovukWarningText,
        continueOrSaveForLaterLinks: ContinueOrSaveForLaterLinks
)

@(
        numberOfKeyIndividuals: NumberOfRequiredKeyIndividuals,
        existingList: List[IndividualProvidedDetails]
)(implicit
        request: RequestHeader,
        messages: Messages
)

@key = @{
    "addToListSummary.Partnership"
}
@title = @{
    messages(s"$key.title.${MessageKeys.singularOrPlural(existingList.size)}", existingList.size)
}
@requiredSize = @{
  numberOfKeyIndividuals.totalListSize
}
@diff = @{
  requiredSize - existingList.size
}

@paddingNeeded = @{numberOfKeyIndividuals match {
  case a @ FiveOrLess(_) => 0
  case a @ SixOrMore(_) => a.requiredPadding
}}

@paddingInset = {
  <p class="govuk-body">@messages(s"$key.complex.intro")</p>
  <ul class="govuk-list govuk-list--bullet">
    <li>@messages(s"$key.complex.bullet1.${MessageKeys.singularOrPlural(requiredSize - paddingNeeded)}", (requiredSize - paddingNeeded))</li>
    <li>@messages(s"$key.complex.bullet2.${MessageKeys.singularOrPlural(paddingNeeded)}", paddingNeeded)</li>
  </ul>
}

@layout(pageTitle = title) {
  <h2 class="govuk-caption-l">@messages(s"lists.caption.title.Partnership")</h2>
  <h1 class="govuk-heading-l">@title</h1>
  <p class="govuk-body">
    <a href="@{AppRoutes.apply.listdetails.nonincorporated.NumberOfKeyIndividualsController.show.url}">
      @messages(s"$key.changeNumber")
    </a>
  </p>
  @govukSummaryList(SummaryList(
    rows = existingList.map { individualDetails =>
      SummaryListRow(
        key = Key(content = Text(individualDetails.individualName.value), classes = "govuk-!-font-weight-regular hmrc-summary-list__key"),
        actions = Some(Actions(items = if(individualDetails.isPrecreated) Seq(
          ActionItem(
            href = AppRoutes.apply.listdetails.nonincorporated.ChangeKeyIndividualController.show(individualDetails._id).url,
            content = Text(messages("common.change")),
            visuallyHiddenText = Some(individualDetails.individualName.value)
          ),
          ActionItem(
            href = AppRoutes.apply.listdetails.nonincorporated.RemoveKeyIndividualController.show(individualDetails._id).url,
            content = Text(messages("common.remove")),
            visuallyHiddenText = Some(individualDetails.individualName.value)
          )
        ) else Seq(
          ActionItem(
            href = AppRoutes.apply.listdetails.nonincorporated.RemoveKeyIndividualController.show(individualDetails._id).url,
            content = Text(messages("common.remove")),
            visuallyHiddenText = Some(individualDetails.individualName.value)
          )
        ), classes = "hmrc-summary-list__actions"))
      )
    }.toSeq,
    classes = "hmrc-list-with-actions hmrc-list-with-actions--short"
  ))

  @if(diff > 0) {
    @if(paddingNeeded > 0) {
      @govukInsetText(InsetText(
        content = HtmlContent(paddingInset)
      ))
    } else {
      @govukInsetText(InsetText(
        content = Text(messages(s"$key.insetText.${MessageKeys.singularOrPlural(diff)}", diff))
      ))
    }
    <p class="govuk-body">
      @continueOrSaveForLaterLinks(
        continueHref = AppRoutes.apply.listdetails.nonincorporated.EnterKeyIndividualController.show.url,
        continueLabel = Some(messages(s"$key.addAnotherPartner"))
      )
    </p>
  } else if (diff < 0) {
    @govukWarningText(WarningText(
      content = Text(
        messages(s"$key.removeExtra.span1.${MessageKeys.singularOrPlural(requiredSize)}", requiredSize) + " " +
        messages(s"$key.removeExtra.span2.${MessageKeys.singularOrPlural(-diff)}", -diff)
      )
    ))
  } else {
    <p class="govuk-body">
      @continueOrSaveForLaterLinks(
        continueHref = AppRoutes.apply.listdetails.CheckYourAnswersController.show.url,
        continueLabel = Some(messages("common.confirmAndContinue"))
      )
    </p>
  }

}
