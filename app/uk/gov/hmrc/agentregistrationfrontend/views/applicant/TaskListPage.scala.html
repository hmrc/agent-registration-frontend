@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentregistration.shared.AgentApplication
@import uk.gov.hmrc.agentregistration.shared.util.SafeEquals.=!=
@import uk.gov.hmrc.agentregistrationfrontend.model.TaskListStatus
@import uk.gov.hmrc.agentregistrationfrontend.views.html.Layout
@import uk.gov.hmrc.agentregistration.shared.AgentApplicationLlp
@import uk.gov.hmrc.agentregistration.shared.AgentApplicationLimitedCompany
@import uk.gov.hmrc.agentregistration.shared.AgentApplicationSoleTrader

@this(
        layout: Layout,
        govukTaskList: GovukTaskList
)

@(
        taskListStatus: TaskListStatus,
        entityName: String,
        agentApplication: AgentApplication)(implicit
        request: RequestHeader,
        messages: Messages
)

@key = @{"taskList"}
@title = @{messages(s"$key.title", entityName)}
@businessTypeKey = @{
    agentApplication match {
        case _: AgentApplicationLlp => "LimitedLiabilityPartnership"
        case _: AgentApplicationLimitedCompany => "LimitedCompany"
        case _: AgentApplicationSoleTrader => "SoleTrader"
        case _: AgentApplication.IsPartnership => "Partnership" // TODO: while design is still coming in let's see if this is sufficient
    }
}
@incomplete = @{
    TaskListItemStatus(
        tag = Some(Tag(
            content = Text(messages(s"$key.status.Incomplete")),
            classes = "govuk-tag--blue"
        ))
    )
}
@complete = @{
    TaskListItemStatus(content = Text(messages(s"$key.status.Completed")))
}
@cannotStart = @{
    TaskListItemStatus(content = Text(messages(s"$key.status.CannotStartYet")))
}

@contactStatus = @{if(taskListStatus.contactDetails.isComplete) complete else incomplete}
@agentDetailsStatus = @{
  if(taskListStatus.agentDetails.isComplete) complete
  else if(taskListStatus.agentDetails.canStart) incomplete
  else cannotStart
}
@amlsStatus = @{if(taskListStatus.amlsDetails.isComplete) complete else incomplete}
@agentsStandardStatus = @{if(taskListStatus.hmrcStandardForAgents.isComplete) complete else incomplete}
@listDetailsStatus = @{
    if(taskListStatus.listDetails.isComplete) complete
    else if(taskListStatus.listDetails.canStart) incomplete
    else cannotStart
}
@listShareStatus = @{
    if(taskListStatus.listShare.isComplete) complete
    else if(taskListStatus.listShare.canStart) incomplete
    else cannotStart
}
@listTrackingStatus = @{
    if(taskListStatus.listTracking.isComplete) complete
    else if(taskListStatus.listTracking.canStart) incomplete
    else cannotStart
}
@soleTraderIdStatus = @{
    if(taskListStatus.listTracking.isComplete) complete
    else if(taskListStatus.listTracking.canStart && taskListStatus.hmrcStandardForAgents.isComplete) incomplete
    else cannotStart
}


@layout(
    pageTitle = title,
    suppressBackLink = true
) {

    <h1 class="govuk-heading-l">@title</h1>
    <h2 class="govuk-heading-m">@messages(s"$key.businessDetails.heading")</h2>
    @govukTaskList(TaskList(
        items = Seq(
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.businessDetails.linkText"))
                ),
                status = complete,
                href = Some(AppRoutes.apply.aboutyourbusiness.CheckYourAnswersController.show.url)
            )
        ),
        idPrefix = "businessDetails"
    ))

    <h2 class="govuk-heading-m">@messages(s"$key.contact.heading")</h2>
    @govukTaskList(TaskList(
        items = Seq(
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.contact.linkText"))
                ),
                status = contactStatus,
                href = Some(AppRoutes.apply.applicantcontactdetails.CheckYourAnswersController.show.url)
            )
        ),
        idPrefix = "contact"
    ))

    <h2 class="govuk-heading-m">@messages(s"$key.accountDetails.heading")</h2>
    @govukTaskList(TaskList(
        items = Seq(
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.accountDetails.linkText"))
                ),
                status = agentDetailsStatus,
                href = if(taskListStatus.agentDetails.canStart) Some(AppRoutes.apply.agentdetails.CheckYourAnswersController.show.url) else None
            )
        ),
        idPrefix = "accountDetails"
    ))

    <h2 class="govuk-heading-m">@messages(s"$key.hmrcStandards.heading")</h2>
    @govukTaskList(TaskList(
        items = Seq(
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.hmrcStandards.amls.linkText"))
                ),
                status = amlsStatus,
                href = Some(AppRoutes.apply.amls.CheckYourAnswersController.show.url)
            ),
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.hmrcStandards.agreement.linkText"))
                ),
                status = agentsStandardStatus,
                href = Some(AppRoutes.apply.HmrcStandardForAgentsController.show.url)
            )
        ),
        idPrefix = "hmrcStandards"
    ))

  @if(businessTypeKey =!= "SoleTrader") {
      <h2 class="govuk-heading-m">@messages(s"$key.lists.heading")</h2>
      @govukTaskList(TaskList(
          items = Seq(
              TaskListItem(
                  title = TaskListItemTitle(
                      content = Text(messages(s"$key.lists.details.linkText.$businessTypeKey"))
                  ),
                  status = listDetailsStatus,
                  href = if(taskListStatus.listDetails.canStart) Some(AppRoutes.apply.listdetails.CheckYourAnswersController.show.url) else None
              ),
              TaskListItem(
                  title = TaskListItemTitle(
                      content = Text(messages(s"$key.lists.share.linkText.$businessTypeKey"))
                  ),
                  status = listShareStatus,
                  href = if(taskListStatus.listShare.canStart) Some(AppRoutes.apply.listdetails.link.LinkController.show.url) else None
              ),
              TaskListItem(
                  title = TaskListItemTitle(
                      content = Text(messages(s"$key.lists.tracking.linkText"))
                  ),
                  status = listTrackingStatus,
                  href = if(taskListStatus.listTracking.canStart) Some(AppRoutes.apply.listdetails.progress.CheckProgressController.show.url) else None
              )
          ),
          idPrefix = "lists"
      ))
  } else {
      <h2 class="govuk-heading-m">@messages(s"$key.soleTraderId.heading")</h2>
      @govukTaskList(TaskList(
          items = Seq(
              TaskListItem(
                  title = TaskListItemTitle(
                      content = Text(messages(s"$key.soleTraderId.linkText.$businessTypeKey"))
                  ),
                  status = soleTraderIdStatus,
                  href = if(taskListStatus.listTracking.canStart && taskListStatus.hmrcStandardForAgents.isComplete) Some(AppRoutes.apply.listdetails.soletrader.ProveIdentityController.show.url) else None
              )
          ),
          idPrefix = "lists"
      ))
  }

    <h2 class="govuk-heading-m">@messages(s"$key.declaration.heading")</h2>
    @govukTaskList(TaskList(
        items = Seq(
            TaskListItem(
                title = TaskListItemTitle(
                    content = Text(messages(s"$key.declaration.linkText"))
                ),
                status = if(taskListStatus.declaration.canStart) incomplete else cannotStart,
                href = if(taskListStatus.declaration.canStart) Some(AppRoutes.apply.DeclarationController.show.url) else None
            )
        ),
        idPrefix = "declaration"
    ))

}
