@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentregistration.shared.llp.MemberProvidedDetails
@import uk.gov.hmrc.agentregistration.shared.llp.{MemberNino, MemberSaUtr}

@this(
  govukSummaryList: GovukSummaryList
)

@(
        key: String,
        memberProvidedDetails: MemberProvidedDetails,
        canChange: Boolean = true
)(implicit messages: Messages)

@import uk.gov.hmrc.agentregistration.shared.llp.MemberSaUtr
@makeSummaryListRow(labelKey: String, valueText: String, changeHref: String) = @{
  SummaryListRow(
    key = Key(content = Text(messages(labelKey))),
    value = Value(content = Text(valueText)),
    actions =
      Option.when(canChange)(
        Actions(
          items = Seq(
            ActionItem(
              href = changeHref,
              content = Text(messages("common.change")),
              visuallyHiddenText = Some(messages(labelKey))
            )
          )
        )
      )
  )
}

@memberNameRow = @{
  makeSummaryListRow(
    labelKey = s"$key.memberName.label",
    valueText = memberProvidedDetails.getOfficerName,
    changeHref = AppRoutes.providedetails.CompaniesHouseNameQueryController.show.toString
  )
}

@telephoneRow = @{
  makeSummaryListRow(
    labelKey = s"$key.telephone.label",
    valueText = memberProvidedDetails.getTelephoneNumber.value,
    changeHref = AppRoutes.providedetails.MemberTelephoneNumberController.show.toString
  )
}

@emailRow = @{
  makeSummaryListRow(
    labelKey = s"$key.email.label",
    valueText = memberProvidedDetails.getEmailAddress.emailAddress.value,
    changeHref = AppRoutes.providedetails.MemberEmailAddressController.show.toString
  )
}

@hasNinoRow(hasNino: String) = @{
  makeSummaryListRow(
    labelKey = s"$key.hasNino.label",
    valueText = hasNino,
    changeHref = AppRoutes.providedetails.MemberNinoController.show.toString
  )
}

@ninoRow(ninoText: String) = @{
  makeSummaryListRow(
    labelKey = s"$key.nino.label",
    valueText = ninoText,
    changeHref = AppRoutes.providedetails.MemberNinoController.show.toString
  )
}

@hasSaUtrRow(hasSaUtr: String) = @{
  makeSummaryListRow(
    labelKey = s"$key.hasSaUtr.label",
    valueText = hasSaUtr,
    changeHref = AppRoutes.providedetails.MemberSaUtrController.show.toString
  )
}

@saUtrRow(saUtrText: String) = @{
  makeSummaryListRow(
    labelKey = s"$key.saUtr.label",
    valueText = saUtrText,
    changeHref = AppRoutes.providedetails.MemberSaUtrController.show.toString
  )
}

@rows = @{
  val base = Seq(memberNameRow, telephoneRow, emailRow)

  val ninoRows = memberProvidedDetails.getNino match {
    case MemberNino.Provided(nino) =>  Seq(hasNinoRow("Yes"),ninoRow(nino.value))
    case MemberNino.NotProvided => Seq(hasNinoRow("No"))
    case MemberNino.FromAuth(nino) => Seq.empty[SummaryListRow]
  }

  val saUtrRows = memberProvidedDetails.getSaUtr match {
    case MemberSaUtr.Provided(saUtr) =>  Seq(hasSaUtrRow("Yes"), saUtrRow(saUtr.value))
    case MemberSaUtr.NotProvided => Seq(hasSaUtrRow("No"))
    case MemberSaUtr.FromAuth(_) | MemberSaUtr.FromCitizenDetails(_) => Seq.empty[SummaryListRow]
  }

  base ++ ninoRows ++ saUtrRows
}

@govukSummaryList(SummaryList(rows = rows))
